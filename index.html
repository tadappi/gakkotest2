<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>GLB Viewer – 2 Sprites (r147 安定版)</title>
  <style>
    body{margin:0;overflow:hidden;background:#fff}
    /* ==== ラベル ==== */
    .label{position:absolute;background:rgba(255,255,255,.95);border:1px solid #777;border-radius:8px;padding:6px 10px;font:14px/1.4 "Segoe UI",sans-serif;box-shadow:0 0 5px rgba(0,0,0,.3);display:none;z-index:10}
    .label img{width:160px;height:auto;display:block}
  </style>
  <!-- ★ three.js r147 の“ビルド版”を読み込み ── これなら
         THREE.OrbitControls がグローバル名前空間に生える -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
  <!-- ===== ラベル（YouTube サムネ & テキスト） ===== -->
  <a href="https://youtu.be/3JjAXCMe9mc" target="_blank">
    <div id="label1" class="label">
      <img src="thumb1.jpg" alt="校庭"><br>① 校庭の動画を見る
    </div>
  </a>
  <a href="https://youtu.be/k4PDAdRwEDo" target="_blank">
    <div id="label2" class="label">
      <img src="thumb2.jpg" alt="校舎"><br>② 校舎の紹介
    </div>
  </a>

<script>
/***** ▼ 基本セットアップ ▼ *****/
const scene   = new THREE.Scene();
const camera  = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, .1, 1000);
camera.position.set(0,10,50);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.target.set(0,5,0);
controls.update();

scene.add(new THREE.AxesHelper(10));
scene.add(new THREE.AmbientLight(0xffffff,.8));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(30,100,30);
scene.add(sun);

/***** ▼ モデル読み込み ▼ *****/
new THREE.GLTFLoader().load('model6.glb', glb=>{
  const m=glb.scene;
  m.scale.set(.1,.1,.1);
  scene.add(m);
});

/***** ▼ スプライト＋ホバー情報 ▼ *****/
const info=[
  {png:'1.png',pos:[4,4,-2],label:'label1'},
  {png:'2.png',pos:[14,5,-10],label:'label2'}
];
const sprites=[];
const tex=new THREE.TextureLoader();
info.forEach(d=>{
  const sp=new THREE.Sprite(new THREE.SpriteMaterial({map:tex.load(d.png),transparent:true}));
  sp.position.set(...d.pos);
  sp.scale.set(4,4,1);
  sp.userData.label=d.label;
  scene.add(sp);
  sprites.push(sp);
});

/***** ▼ レイキャストでホバー判定 ▼ *****/
const ray   = new THREE.Raycaster();
const mouse = new THREE.Vector2();
let   shown = null;

addEventListener('mousemove',e=>{
  mouse.x=(e.clientX/innerWidth)*2-1;
  mouse.y=-(e.clientY/innerHeight)*2+1;
});
addEventListener('click',()=>{ if(shown) shown.parentElement.click(); });

/***** ▼ 描画ループ ▼ *****/
(function loop(){
  requestAnimationFrame(loop);
  controls.update();

  // ホバー処理
  ray.setFromCamera(mouse,camera);
  const hit=ray.intersectObjects(sprites)[0];
  if(hit){
    const el=document.getElementById(hit.object.userData.label);
    if(shown&&shown!==el) shown.style.display='none';
    el.style.left=`${event.clientX+12}px`;
    el.style.top =`${event.clientY+12}px`;
    el.style.display='block';
    shown=el;
  }else if(shown){ shown.style.display='none'; shown=null; }

  renderer.render(scene,camera);
})();

/***** ▼ リサイズ対応 ▼ *****/
addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
