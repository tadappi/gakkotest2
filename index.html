<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>GLB Viewer – 2 Sprites (CDN r147 固定版)</title>
  <style>
    body { margin: 0; overflow: hidden; background:#fff; }

    /*===== ホバー時に出すラベル =====*/
    .label {
      position:absolute;
      background:rgba(255,255,255,.95);
      border:1px solid #999;
      border-radius:8px;
      padding:8px 12px;
      font:14px/1.4 "Segoe UI",sans-serif;
      display:none;
      z-index:10;
      box-shadow:0 0 5px rgba(0,0,0,.3);
    }
    .label img{ width:160px; height:auto; display:block; }
  </style>

  <!-- ★ three.js r147 ＝ グローバル(非ESM) 版を使用   -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>

<!-- ---------- ラベル（YouTubeリンク付き） ---------- -->
<a href="https://youtu.be/3JjAXCMe9mc" target="_blank">
  <div class="label" id="label1">
    <img src="thumb1.jpg" alt="校庭">
    ① 校庭の動画を見る
  </div>
</a>
<a href="https://youtu.be/k4PDAdRwEDo" target="_blank">
  <div class="label" id="label2">
    <img src="thumb2.jpg" alt="校舎">
    ② 校舎の紹介
  </div>
</a>

<script>
  /* ===== シーン基本セットアップ ===== */
  const scene   = new THREE.Scene();
  const camera  = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
  camera.position.set(0,10,50);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.target.set(0,5,0);
  controls.update();

  scene.add(new THREE.AmbientLight(0xffffff, .8));
  const dir = new THREE.DirectionalLight(0xffffff, 1);
  dir.position.set(30,100,30);
  scene.add(dir);
  scene.add(new THREE.AxesHelper(10));

  /* ===== モデル読み込み ===== */
  new THREE.GLTFLoader().load('model6.glb', glb=>{
    const m=glb.scene;
    m.scale.set(.1,.1,.1);
    scene.add(m);
  });

  /* ===== スプライト作成 ===== */
  const spriteInfo=[
    {png:'1.png',pos:[4,4,-2],label:'label1'},
    {png:'2.png',pos:[14,5,-10],label:'label2'}
  ];
  const sprites=[];
  const texLoader=new THREE.TextureLoader();
  spriteInfo.forEach(info=>{
    const mat=new THREE.SpriteMaterial({map:texLoader.load(info.png),transparent:true});
    const sp = new THREE.Sprite(mat);
    sp.position.set(...info.pos);
    sp.scale.set(4,4,1);
    sp.userData.labelId=info.label;
    scene.add(sp);
    sprites.push(sp);
  });

  /* ===== レイキャストでホバー判定 ===== */
  const ray=new THREE.Raycaster();
  const mouse=new THREE.Vector2();
  let shown=null;

  function onMove(e){
    mouse.x = (e.clientX/innerWidth)*2-1;
    mouse.y = -(e.clientY/innerHeight)*2+1;
  }
  addEventListener('mousemove',onMove);
  addEventListener('click',()=>{
    if(shown){ shown.parentElement.click(); }
  });

  /* ===== ループ ===== */
  function loop(){
    requestAnimationFrame(loop);
    controls.update();

    // ホバー処理
    ray.setFromCamera(mouse,camera);
    const hit = ray.intersectObjects(sprites)[0];
    if(hit){
      const id = hit.object.userData.labelId;
      const el = document.getElementById(id);
      if(shown && shown!==el) shown.style.display='none';
      el.style.left = `${event.clientX+12}px`;
      el.style.top  = `${event.clientY+12}px`;
      el.style.display='block';
      shown = el;
    }else if(shown){
      shown.style.display='none';
      shown=null;
    }

    renderer.render(scene,camera);
  }
  loop();

  /* ===== リサイズ対応 ===== */
  addEventListener('resize',()=>{
    camera.aspect=innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
  });
</script>
</body>
</html>
